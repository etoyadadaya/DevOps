# Использование планировщика заданий CRON:

***CRON*** - это программа-демон. Её основная задача выполнять указанные пользователем процессы в указанное пользователем время, например с определённой периодичностью.

***Давайте рассмотрим синтаксис настройки одной задачи cron:***

    Минута час день месяц день_недели /путь/к/исполняемому/файлу

Для некоторых часто используемых наборов были придуманы специальные переменные, вот они:

* @reboot -- при загрузке, только один раз

* @yearly, @annually -- раз год

* @monthly -- раз в месяц

* @weekly -- раз в неделю

* @daily, @midnight -- каждый день

* @hourly -- каждый час

# Сетевые интерфейсы:

***Сетевые интерфейсы предназначены для передачи данных между программами через компьютерную сеть.***

В Linux любые данные, которые компьютер отправляет в сеть или получает из сети, проходят через сетевой интерфейс.

***Сетевые интерфейсы могут быть как физическими, так и виртуальными.***

***Вот примеры типов сетевых интерфейсов:***

* eth -- Сетевой интерфейс к карте Ethernet или картам WaveLan (Radio Ethernet).

* ax -- Сетевой интерфейс к устройствам любительского радио AX.25.

* arc0e, arc0s -- Сетевой интерфейс к карте ArcNet. Используется инкапсуляция пакетов в формате Ethernet или RFC 1051.

* wlan -- Сетевой интерфейс wi-fi адаптеров.

# DHCP:

Для работы по сети любому устройству требуется IP-адрес. В протоколе IPv4 это числовой идентификатор, состоящий из 4 разрядов, каждый из которых отделяется точкой, без него устройство не может быть определено в сетевой инфраструктуре.

***Прикладной протокол DHCP выполняет всю работу по подбору сетевых настроек автоматически, без необходимости присваивать вручную каждому устройству свой IP-адрес. Это очень упрощает работу системного администратора в случае расширения сети.***

### DHCP NETWORK:

***DHCP*** — это протокол прикладного уровня модели TCP/IP, используемый для назначения IP-адреса клиенту. Каждому клиенту, т.е. компьютеру в локальной сети, можно вручную назначить IP-адрес. Но в больших сетях это очень трудоемко и к тому же, чем крупнее локальная сеть, тем выше вероятность ошибки конфигурации. Вот почему протокол DHCP был создан для автоматизации назначения IP-адресов.

Для получения адреса требуется четыре шага.

Этот процесс называется ***DORA*** по первым буквам каждого шага:

* Открытие - Discovery

* Предложение - Offer

* Запрос - Request

* Подтверждение - Acknowledgement

### DHCP Параметры:

Клиенту нужен не только IP-адрес, но и другие параметры DHCP для работы в сети, такие как маска подсети, шлюз по умолчанию и адрес сервера. Опции представляют собой пронумерованные точки, строки данных, которые содержат параметры конфигурации, требуемые клиентом сервера.

***Опишем некоторые варианты:***

* Опция 1 - IP-маска подсети;

* Опция 3 — шлюз по умолчанию;

* Опция 6 - Адрес DNS-сервера (основной и резервный);

* Опция 51 определяет, на какой срок IP-адрес предоставляется клиенту в аренду;

* Опция 55 — это список запрошенных опций. Клиент всегда запрашивает варианты правильной конфигурации. Отправляя сообщение с опцией 55, клиент устанавливает список запрошенных числовых кодов опций в порядке предпочтения. DHCP-сервер пытается отправить ответ с параметрами в том же порядке.

***Заставить DHCP-клиент (dhclient) обновить IP-адрес:***

Вам необходимо использовать клиент протокола динамической конфигурации хоста, то есть команду dhclient. Клиент обычно не освобождает текущую аренду, так как это не требуется протоколом DHCP. Некоторые кабельные интернет-провайдеры требуют, чтобы их клиенты уведомляли сервер, если они хотят освободить назначенный IP-адрес. Команда dhclient предоставляет средства для настройки одного или нескольких сетевых интерфейсов с использованием протокола динамической конфигурации хоста, протокола BOOTP или, в случае сбоя этих протоколов, путем статического назначения адреса. Давайте посмотрим на команду Linux для принудительного освобождения IP-адреса DHCP-клиента.

***Предупреждение!*** Освобождение вашего IP-адреса всегда приводит к отключению сетевого интерфейса/WiFi.

Так что будьте осторожны с удаленными системами.

***Флаг -r*** явно освобождает текущую аренду, и как только аренда освобождается, клиент завершает работу. Например, откройте терминальное приложение и введите команду:

    $ sudo dhclient -r

***Теперь получите новый IP-адрес с помощью DHCP в Linux:***

    $ sudo dhclient

***Чтобы обновить или освободить IP-адрес для конкретного интерфейса, например, eth0, введите:***

    $ sudo dhclient -r eth0
    $ sudo dhclient eth0

# SSHD:

***SSH или Secure Shell*** - это сетевой протокол безопасного доступа из одного компьютера к другому по сети.

***SSHd*** — это служба, принимающая запросы на соединения от клиентов, т.е. других компьютеров.

***Настройка сервера SSH производится путём настройки программы-демона SSHd.***

***Программа-демон*** - это программа, запускаемая самой системой и работающая в фоновом режиме.

В первую очередь следует обратить внимание на следующие параметры: ***Port, AddressFamily, ListenAddress.***

Первый глобально задаёт номер порта, через который будет работать соединение и если оставить его стандартным, т.е. 22, то велика вероятность, что он будет слишком часто сканироваться роботами.

***И ещё немного про то, как, собственно, пользоваться SSH. Для подключения к серверу используется команда:***

ssh user_name@host_name, где user_name – имя пользователя в системе, host_name – имя узла, к которому производится подключение.

При этом утилита ssh запросит (в зависимости от настроек сервера) логин, пароль или парольную фразу для разблокировки приватного ключа пользователя.

***Утилита ssh позволяет сразу выполнить нужную команду без открытия терминала удаленной машины. Например, команда:***

    ssh user@host ls

Выполнит команду ls на удаленном сервере и вернет ее вывод в текущий терминал.

# Утилита df:

***df*** - это команда для получения подробного отчета об использовании дискового пространства системы.

***-H*** -- ключ вывода всех размеров в гигабайтах

***-P*** -- ключ использования формата вывода POSIX

***-x*** -- ключ вывода информации обо всех размерах, кроме указанных файловых систем

# Утилита du:

***du*** - это команда для получения приблизительного объема дискового пространства, используемого указанными при вызове команды файлами или каталогами.

***-c*** -- ключ вывода в конце общего размера всех папок

***-d*** -- максимальная глубина вложенности директорий

***-s*** -- ключ вывода только общего размера

# Утилита fdisk:

Поскольку жесткие диски имеют большой объем, их пространство обычно разбивают на несколько частей — разделов диска, и работать с ними можно, как будто это независимые диски в системе.

***fdisk*** - это команда для управления разделами жёсткого диска, а также получения информации о них.

***m*** -- команда выключения или переключения режима отображения информации о памяти

***w*** -- команда записи новой таблицы разделов на диск (по сути -- сохранить изменения)

***q*** -- команда выхода без сохранения

# Работа с системными журналами:

***Системные журналы*** - это файлы, в которых хранятся все события и процессы, происходящие с файлами, работа оборудования и т.д.

***Системных журналов много и все они расположены в директории /var/log/.***

***Чтобы посмотреть логи, удобно использовать несколько утилит командной строки Linux. Вот команды, которые чаще всего используются для этих целей:***

* less

* more

* cat

* head

* grep

* tail

* zcat

* zgrep

* zmore

* vi

* nano

***Рассмотрим некоторые из них на примере лога /var/log/dmesg:***

* less -- просмотр логов с возможностью прокрутки: 

* tail -- просмотр логов в реальном времени

* cat -- открытие лог файла

* head -- просмотр первых строки лога

* grep -i error -- вывод только ошибок из лога 

# Утилита ncdu:

***ncdu*** - это команда, имеющая то же назначение, что и du, но обладающая приятным и удобным интерфейсом.

Использование программы элементарное. Для сканирования и обзора текущей директории, в которой вы находитесь, просто запустите программу ncdu:*** 

Чтобы просканировать всю файловую систему, нужно указать путь. Для корня это слэш. Также пригодиться опция -x — не выходить за пределы текущей файловой системы. Дело в том, что к корневой файловой системе могут быть смонтированы другие диски — и без этой опцией они также будут посчитаны. Выполнение команды ncdu -x /:***

***Для перехода в выбранную директорию используйте одну из следующих кнопок:***

* курсор вправо

* ENTER

* l

***Для возврата в родительскую директорию используйте одну из следующих кнопок:***

* курсор влево

* <

* h

***Для сортировки директорий и файлов используются следующие кнопки (нажмите ещё раз для обратного порядка):***

* n — по имени файла

* s — по размеру файла

* C — по количеству элементов

* M — по времени модификации последнего дочернего элемента

# Установка и настройка службы времени:

Во множестве дистрибутивах Unix-подобных операционных систем за синхронизацию даты и времени отвечает специальная утилита. Она находится в активном состоянии по умолчанию, поэтому у пользователей нет необходимости как-то ее настраивать или изменять. Однако иногда такая надобность все же появляется из-за разных причин, например, случайных сбоев.

Компьютеры во всем мире используют NTP (сетевой протокол времени) для синхронизации своего времени со стандартными эталонными часами через интернет с помощью иерархии серверов NTP.

***Настройка автоматической синхронизации времени может потребоваться, например, при переходе с утилиты timesyncd, отвечающей за синхронизацию времени по умолчанию, на более надежный протокол NTPD. Для это следует:***

* Отключить стандартную утилиту

* Рекомендуется убедиться, что система обновлена до последней версии

* Установить NTP, который будет активирован автоматически, поэтому никаких дополнительных команд вводить не нужно.

# Команда top:

***Команда top*** показывает запущенные в Linux процессы программ и служб, данные о потреблении системных ресурсов и позволяет искать, останавливать и управлять процессами.

***Вот несколько примеров работы с командой top:***

Если вы хотите отображать только те процессы, которые используют ресурсы процессора используйте команду i:

* Чтобы выделить поле, по которому сейчас выполняется сортировка нажмите клавишу y. После этого вся колонка будет выделена жирным:

* m -- команда выключения или переключения режима отображения информации о памяти

* F -- команда настройки полей с информацией о процессах

* L -- команда поиска по слову

# Команда htop:

***Команда htop*** выполняет примерно ту же задачу, что и top, но имеет определённые преимущества и недостатки: более удобные поиск и фильтрация, но менее гибкая настройка отображения процессов.

***Вот несколько примеров работы с командой htop:***

* Открыв htop, сразу виден список запущенных процессов. Конечно, здесь отображены не все процессы Linux. По умолчанию выводятся процессы, запущенные от имени вашего пользователя: 

* К отображению можно добавить и дополнительные параметры с помощью меню Setup. Там все очень просто, читайте подсказки и следуйте указаниям. Например, добавлен параметр PPID: 

* Также есть интересная возможность разместить процессы в виде дерева. Вы сможете увидеть, каким процессом был запущен тот или иной процесс. Для отображения дерева нажмите кнопку F5: 

# NAT:

***NAT*** — это аббревиатура от «трансляция сетевых адресов».

NAT происходит, когда изменяется один из IP-адресов в заголовке IP-пакета, т. е. IP-адрес источника или IP-адрес назначения.

***SNAT (Source NAT)*** - SNAT изменяет частный IP-адрес исходного хоста на общедоступный IP-адрес. Он также может изменить исходный порт в заголовках TCP/UDP. SNAT обычно используется внутренними пользователями для доступа в Интернет.

***DNAT (Destination NAT)*** - Destination NAT изменяет адрес назначения в IP-заголовке пакета. Он также может изменить порт назначения в заголовках TCP/UDP. DNAT используется, когда нам нужно перенаправить входящие пакеты с общедоступным адресом/портом на частный IP-адрес/порт внутри вашей сети.

# Firewall: 

***iptables:*** 

***iptables*** — это утилита брандмауэра командной строки, которая использует цепочки политик для разрешения или блокировки трафика. Когда соединение пытается установиться в вашей системе, iptables ищет правило в своем списке, чтобы сопоставить его. Если он не находит его, он прибегает к действию по умолчанию.

***nmap:***

***Nmap*** — это инструмент командной строки Linux для исследования сети и аудита безопасности. Этот инструмент обычно используется хакерами и энтузиастами кибербезопасности, а также сетевыми и системными администраторами.

***Он используется для следующих целей:***

* Информация о сети в реальном времени

* Подробная информация обо всех IP-адресах, активированных в вашей сети.

* Количество открытых портов в сети

* Предоставьте список активных хостов

* Сканирование портов, ОС и хостов

# Addressing. Continuation:

***IP-классификация:***

***Существуют классификации IP-адресов как «частные» и «публичные». Следующие диапазоны адресов зарезервированы для частных (также известных как LAN) сетей:***

* 10.0.0.0 — 10.255.255.255 (10.0.0.0/8),

* 172.16.0.0 — 172.31.255.255 (172.16.0.0/12),

* 192.168.0.0 — 192.168.255.255 (192.168.0.0/16).

* 127.0.0.0 — 127.255.255.255 (Зарезервировано для петлевых интерфейсов (не используется для связи между узлами сети), так называемый localhost)

# Порты:

Стандарт определяет для каждого из протоколов TCP и UDP возможность одновременного выделения до 65536 уникальных портов на хосте, обозначаются номерами от 0 до 65535.

***Весь ассортимент портов разбит на 3 группы:***

* От 0 до 1023 называются привилегированными или зарезервированными (используются для системы и некоторых популярных программ)

* Порты с 1024 по 49151 называются зарегистрированными портами.

* Порты с 49151 по 65535 называются динамическими портами.

# ipcalc:

***ipcalc*** — это утилита, которая может выполнять простые манипуляции с IPv4-адресами.

# Скорость соединения:

Базовой единицей скорости передачи информации является бит в секунду (бит/с).

Разница между байтами в секунду (Б/с) и битами в секунду такая же, как разница между байтами и битами: 1 Б/с = 8 бит/с.

Точно так же разница между килобайтами в секунду (КБ/с) и Б/с такая же, как разница между килобайтами и байтами: 1 КБ/с = 1024 Б/с. И так далее.

# iperf3:

***iperf3*** — это программа для измерения пропускной способности сети в режиме реального времени. Это один из мощных инструментов для тестирования максимально достижимой пропускной способности в IP-сетях (поддерживает IPv4 и IPv6).

Чтобы проверить пропускную способность сети, вам нужно сначала подключиться к удаленной машине, которую вы будете использовать в качестве сервера, и запустить iperf3 в режиме сервера, используя флаг -s, по умолчанию он будет прослушивать порт 5201. Вы можете указать формат (k, m, g для кбит, мегабит, гигабит или K, M, G для килобайт, мегабайт, гигабайт) для отчета, используя переключатель -f, как показано.

    iperf3 -s -f К

При желании вы можете запустить сервер в качестве демона, используя флаг -D, и записывать сообщения сервера в файл журнала следующим образом.

    iperf3 -s -D > iperf3log

Затем на вашем локальном компьютере, который мы будем рассматривать как клиент (где происходит фактический бенчмаркинг), запустите iperf3 в клиентском режиме, используя флаг -c, и укажите хост, на котором работает сервер (используя либо его IP-адрес, либо домен, либо имя хоста).

    iperf3 -c 192.168.10.1 -f К

# ICMP-протокол:

***Протокол ICMP*** — это протокол уведомления об ошибках.

***Стек TCP/IP имеет специальный механизм обмена сообщениями, позволяющий маршрутизаторам уведомлять сетевые узлы об ошибках или нештатных ситуациях, который называется протоколом управляющих сообщений Интернета (ICMP).***

# Как добавить статические маршруты в Ubuntu Linux:

Добавление статического маршрута в Linux может быть выполнено командой:

    ip r add [адрес, к которому мы хотим подключиться] dev [имя сети]

Но соединение, созданное этой командой, исчезнет после перезагрузки сети или системы.

В Ubuntu Linux, чтобы сделать статические маршруты постоянными, нам нужно добавить записи маршрута в файл сетевого интерфейса (этот файл уже упоминался выше) с помощью свойства route.

Вам необходимо перезагрузить конфигурацию netplan с помощью команды netplan apply, если вы добавите новую запись маршрута в файл YAML.

# Combined Log Format:

Основная проблема с лог-файлами и потребностью в структурированном формате, заключается в том, что они, как правило, представляют собой неструктурированные текстовые данные, что затрудняет поиск в журналах какой-либо полезной информации.

***Формат журнала*** — это структурированный формат, позволяющий легко считывать и анализировать журналы.

В этом сила использования структурированных журналов и поддерживающей их системы управления журналами.

***Комбинированный формат журнала*** — это стандартизированный формат журнала, используемый рядом веб-серверов для отслеживания доступа к веб-сайтам.

***Формат определяется этим выражением:***

    "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\""

***Он состоит из следующих полей, разделенных пробелами:***

* Имя хоста или IP-адрес посетителя сайта.

* Идентификатор клиента RFC 1413. Это отмечено как ненадежное и обычно пустое (обозначается дефисом (-) в файле).

* Имя пользователя, обращающегося к документу. Будет дефисом для общедоступных веб-сайтов, на которых нет контроля доступа пользователей.

***Строка временной метки, заключенная в квадратные скобки, например:***

    [12/дек/2012:12:12:12 -0500]

* HTTP-запрос заключен в двойные кавычки, например, «GET /stuff.html HTTP/1.1».

* Код состояния HTTP.

* Количество байтов, переданных в запрошенном объекте.

* URL-адрес, с которого пользователь пришел на ваш сайт (в двойных кавычках).

* Строка пользовательского агента, отправленная клиентом (в двойных кавычках). Может использоваться для определения того, какой браузер использовался.

# nginx:

***nginx (произносится как "engine-x")*** - это обратный прокси-сервер с открытым исходным кодом для протоколов HTTP, HTTPS и т.д. nginx также используется, как балансировщик нагрузки, веб-сервер и для кеширования HTTP. В проекте nginx уделяется особое внимание высокому параллелизму, высокой производительности и низкому использованию памяти.

У nginx есть один главный и несколько рабочих процессов. Основная задача главного процесса — чтение и проверка конфигурации и управление рабочими процессами.

***Рабочие процессы выполняют фактическую обработку запросов.***

Как работают nginx и его модули, определяется в конфигурационном файле. По умолчанию, конфигурационный файл называется nginx.conf

# Docker: 

***Контейнер*** – новый "исполняемый файл", включающий в себя все необходимые продукту зависимости.

***Главное преимущество контейнеризации*** – изоляция зависимостей и единая простая точка запуска ПО.

***Основные понятия:***

***Докер образ*** – "упаковка" для приложения и зависимостей (в том числе системных).

***Контейнер*** – экземпляр образа, то есть "оживший" образ.

***Docker*** — это платформа, которая предназначена для разработки, развёртывания и запуска приложений в контейнерах. Docker – «де-факто» стандарт инструмента контейнеризации в индустрии, но он не является первым или последним среди технологий контейнеризации.

Предшественниками контейнеров Docker были виртуальные машины. Виртуальная машина, как и контейнер, изолирует приложение и его зависимости от внешней среды. Однако контейнеры Docker обладают преимуществами перед виртуальными машинами. Так, они потребляют меньше ресурсов, их очень легко переносить, они быстрее запускаются и приходят в работоспособное состояние.

Докер образ состоит из слоев. Каждый слой описывает какое-то изменение, которое должно быть выполнено с данными на запущенном контейнере. Структура связей между слоями — иерархическая. Имеется базовый слой, на который «накладываются» остальные слои. Для создания образа используется Dockerfile. Каждая инструкция в нем создает новый слой.

# Dockle:

***Dockle*** — это инструмент для проверки безопасности образов контейнеров, который можно использовать для поиска уязвимостей.

***Основные функции и преимущества Dockle:***

* поиск уязвимостей в образах,

* помощь в создании правильного Dockerfile,

* простота в использовании, нужно указать только имя образа,

* поддержка CIS Benchmarks.

# Docker Compose:

***Docker Compose*** — это инструментальное средство, которое предназначено для решения задач, связанных с развёртыванием проектов. Docker Compose может пригодиться, если для обеспечения функционирования проекта используется несколько сервисов.

Docker Compose используется для одновременного управления несколькими контейнерами, входящими в состав приложения. Этот инструмент предлагает те же возможности, что и Docker, но позволяет работать с более сложными распределенными приложениями, например микросервисными.

# CI/CD:

***CI/CD*** - Это набор принципов и практик, которые позволяют чаще и надежнее развертывать изменения программного обеспечения.

***Причины применения CI/CD:***

* Командная разработка

* Длинный жизненный цикл ПО

* Сокращение релизного цикла

* Сложность развертывания и тестирования крупных систем

* Человеческий фактор

***CI/CD pipeline*** - Это последовательность действий (скриптов) для определенной версии кода в репозитории, которая запускается автоматически при совершении изменений.

***Основы CI:***

***CI (Continuous Integration)*** — в дословном переводе «непрерывная интеграция». Имеется в виду интеграция отдельных кусочков кода приложения между собой. CI обычно выполняет 2 задачи, описанные далее.

***BUILD:***

* Проверяем, собирается ли вообще код

* Готовим артефакты для следующих стадий

***TEST:***

* Тесты кодстайла

* Модульные тесты

* Интеграционные тесты

* Прочие тесты, которые у вас есть

* Отчеты о тестах

***Основы CD:***

***CD (Continuous Delivery)*** — это расширение непрерывной интеграции, поскольку оно автоматически развертывает все изменения кода в тестовой и/или производственной среде после этапа сборки. CD может выполнять задачи, описанные далее.

***PUBLISH (В случае применения докера для развёртывания):***

* Собираем образы контейнеров

* Пушим образы туда, откуда их будем потом брать для развертывания

***UPDATE CONFIGS:***

* Обновляем конфигурацию на машинах

***DEPLOY STAGING:***

* Развертывание тестовой среды для ручных тестов, QA, и прочих не автоматизируемых проверок

* Может запускаться как вручную, так и автоматически при успешном прохождении стадий CI

***DEPLOY PRODUCTION:***

* Разворачиваем новую версию системы на "продакшн"

* Этот этап желательно запускать вручную, а не автоматически

* По желанию можно настроить только для определенной ветки репозитория (master, release и т.п.)
